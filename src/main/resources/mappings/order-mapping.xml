<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OrderDAO">
	<resultMap type="order_code" id="orderCode">
		<id property="no" column="NO" />
		<result property="id" column="ID" />
		<result property="name" column="NAME" />
		<result property="tel" column="TEL" />
		<result property="address" column="ADDRESS" />
		<result property="request" column="REQUEST" />
		<result property="store_name" column="STORE_NAME" />
		<result property="order_type" column="ORDER_TYPE" />
		<result property="order_time" column="ORDER_TIME" />
		<result property="delivery_time" column="DELICERY_TIME" />
		<result property="use_point" column="USE_POINT" />
		<result property="use_coupon" column="USE_COUPON" />
		<result property="total_price" column="TOTAL_PRICE" />
		<result property="payment_list" column="PAYMENT_LIST" />
		<result property="payment_status" column="PAYMENT_STATUS" />
		<result property="status" column="STATUS" />
	</resultMap>
	
	<resultMap type="order_list" id="orderList">
		<id property="no" column="NO" />
		<result property="menu_type" column="MENU_TYPE" />
		<result property="menu_name" column="MENU_NAME" />
		<result property="quantity" column="QUANTITY" />
		<result property="single_price" column="SINGLE_PRICE" />
		<result property="step01" column="STEP01" />
		<result property="add_topping" column="ADD_TOPPING" />
		<result property="add_meat" column="ADD_MEAT" />
		<result property="add_cheese" column="ADD_CHEESE" />
		<result property="step03" column="STEP03" />
		<result property="set_price" column="SET_PRICE" />
	</resultMap>
	
	<select id="getPagingList" resultType="order_code">
		select * from order_code
		where STATUS='주문 완료'
		ORDER BY ORDER_TIME DESC, NO DESC
		limit #{listSize} offset #{startList}
	</select>
	
	<select id="getPageListCnt" resultType="int">
		select count(*) from order_code where STATUS='주문 완료'
	</select>

	<select id="orderCodeList" parameterType="order_code" resultType="order_code">
		select * from order_code where ID=#{id} order by ORDER_TIME DESC
	</select>

	<select id="orderList" parameterType="order_list" resultType="order_list">
		select * from order_list where NO=#{no}
	</select>
	
	<select id="selectHomeway" parameterType="order_code" resultType="order_code">
		select * from order_code where ID=#{id} and ORDER_TYPE='배달'
		order by ORDER_TIME DESC
	</select>
	
	<select id="selectFastway" parameterType="order_code" resultType="order_code">
		select * from order_code 
		where ID=#{id} and ORDER_TYPE not in(select ORDER_TYPE from order_code where ORDER_TYPE='배달')
		order by ORDER_TIME DESC
	</select>
	
	<select id="countOrderList" resultType="int">
		select count(*) from order_code where ID=#{id}
	</select>
	
	<!-- insert -->
	<insert id="insertOrderCode" parameterType="order_code">
		insert into order_code (id, name, tel, address, request, store_name, order_type,
								use_point, use_coupon, total_price, payment_list, payment_status, status)
		values(#{id}, #{name}, #{tel}, #{address}, #{request}, #{store_name}, #{order_type},
								#{use_point}, #{use_coupon}, #{total_price}, #{payment_list}, #{payment_status}, '주문 접수')
		
	</insert>
	
	<insert id="insertOrderList" parameterType="order_list">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select MAX(no) from order_code
		</selectKey>
		insert into order_list values(#{no}, #{menu_type}, #{menu_name}, #{quantity}, #{single_price}, #{step01}, #{add_topping},
										#{add_meat}, #{add_cheese}, #{step03}, #{set_price})
	</insert>
	
</mapper>